import { useCallback } from "react"
import { Config } from "wagmi"
import {
  EventCallback,
  useSubscribeToConnectorEvent,
} from "./useSubscribeToConnectorEvent"
import {
  isWalletNetworkDoesNotMatchProviderChainError,
  BitcoinWalletConnectionError,
} from "../wallet/errors"

function useSubscribeToWalletNetworkDoesNotMatchProviderChain(
  config: Config,
  connectorId: string,
  errorCallback: EventCallback<"error">,
) {
  const callback = useCallback<EventCallback<"error">>(
    (data) => {
      const { error } = data
      if (!(error instanceof BitcoinWalletConnectionError)) return

      const { cause } = error

      if (isWalletNetworkDoesNotMatchProviderChainError(cause))
        errorCallback(data)
    },
    [errorCallback],
  )

  useSubscribeToConnectorEvent(config, connectorId, "error", callback)
}

export { useSubscribeToWalletNetworkDoesNotMatchProviderChain }
